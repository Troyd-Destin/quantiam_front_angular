<div *ngIf="container && !container.hasOwnProperty('id')">
	
	<center style="margin-top:30px;"><h2> This container does not exist yet. </h2></center>
	
</div>

<div *ngIf="container && container.hasOwnProperty('id')" fxLayout="column" fxLayoutGap="10px" fxLayoutAlign="center center">

	<div fxLayoutGap="20px" fxLayout="row"  fxLayout.xl="row wrap"  fxLayout.lg="row wrap" fxLayoutAlign="start stretch">
			
		<mat-accordion  multi="true" fxFlex.lg=40 fxFlex.xl=40>
			<mat-expansion-panel expanded="true">
				<mat-expansion-panel-header>
					<mat-panel-title>
						<b>	Material Information </b>
						
					</mat-panel-title>
					<mat-panel-description>
						{{container.lot.material.name}} <i style="margin-left:10px;">{{container.lot.material.grade}}</i>
					</mat-panel-description>    
				</mat-expansion-panel-header>		
				<div>
				
					<div fxLayoutGap="5px" fxLayout="row wrap" fxLayout.sm="column"  fxLayoutAlign="start stretch"  >	
						  <mat-form-field class="full-width"  fxFlex>
							  <input #MaterialName [disabled]="!editMaterial" (change)="updateMaterial(MaterialName)" type="text" matInput placeholder="Name" [(ngModel)] ='container.lot.material.name' name="name" disabled>
						 </mat-form-field>  
						  <mat-form-field class="full-width" fxFlex>
							  <input  #Grade [disabled]="!editMaterial" (change)="updateMaterial(Grade)" type="text" matInput placeholder="Grade" [(ngModel)] ='container.lot.material.grade' name="grade" disabled>
						 </mat-form-field>
						   <mat-form-field class="full-width" fxFlex *ngIf="!editMaterial">
							  <input  type="text" matInput placeholder="Supplier" [(ngModel)] ='container.lot.material.supplier.supplier_name' name="supplier" disabled>
						 </mat-form-field>  
						 
						 <app-select2-material-supplier
								fxLayoutAlign="start center"
								[placeholder]="container.lot.material.supplier.supplier_name" 
								*ngIf="editMaterial"
								enable_create="true"
								(selectedValue)="changedSupplier($event)"
								[default_lot]="container.lot.material.supplier_id"
						
						
						></app-select2-material-supplier>
						
						 
						 
					</div>		
					
					<div fxLayoutGap="5px"  fxLayout="row wrap"   >	
						
						
						   <mat-form-field class="full-width" fxFlex>
							  <input #Nomenclature [disabled]="!editMaterial" (change)="updateMaterial(Nomenclature)" type="text" matInput placeholder="Formula" [(ngModel)] ='container.lot.material.formula' name="formula" >
						 </mat-form-field>  
						
						  <mat-form-field class="full-width"  fxFlex="20" fxFlex.lt-lg="20">
							  <input   #Cas [disabled]="!editMaterial" (change)="updateMaterial(Cas)" type="text" matInput placeholder="CAS #" [(ngModel)] ='container.lot.material.cas' name="cas" >
						 </mat-form-field> 
						 <mat-form-field class="full-width" fxFlex>
							  <input #Catalog [disabled]="!editMaterial" (change)="updateMaterial(Catalog)"  type="text" matInput placeholder="Catalog #" [(ngModel)] ='container.lot.material.catalog' name="catalog" >
							  <mat-hint> Product Number eg. "2332A-DDS2" </mat-hint>
						 </mat-form-field> 
						  <mat-form-field   class="full-width" fxFlex >
							  <input   #ForumlaWeight [disabled]="!editMaterial" (change)="updateMaterial(ForumlaWeight)" type="number" matInput placeholder="Forumla Weight" [(ngModel)] ='container.lot.material.formula_weight' name="formula_weight" >
						 </mat-form-field>
						   <mat-form-field class="full-width" fxFlex >
						 	  <input   #Density [disabled]="!editMaterial" (change)="updateMaterial(Density)" type="text" matInput placeholder="Density (g/ml)" [(ngModel)] ='container.lot.material.density' name="density" >
						</mat-form-field>	
						  <!-- --> 
						 
						
					</div>
					<div fxLayout="row wrap"  fxLayoutAlign="end center">
				
					<button mat-button   *ngIf="canEdit" (click)="editMaterial = !editMaterial"  > Edit </button>
					 <button mat-button  *ngIf="canEdit && container.lot.material.sds" (click)="deleteSDS()" color="warn"  > Delete SDS </button> 
					
					</div>
					
				</div>
			</mat-expansion-panel>
			<!-- <mat-expansion-panel expanded="true">
				<mat-expansion-panel-header>
					<mat-panel-title>
						<b>	Lot Information </b>
					</mat-panel-title>
					<mat-panel-description>
						{{container.lot.lot_name}} 
					</mat-panel-description>    
				</mat-expansion-panel-header>		
				<div fxLayoutGap.sm="20px" fxLayout="column"  fxLayoutAlign="start stretch">
				
					<div fxLayoutGap="5px" fxLayout="row wrap" fxLayout.sm="column"  fxFlex="100" >	
						  <mat-form-field *ngIf="!editLot" class="full-width" fxFlex>
							  <input  type="text" matInput placeholder="Name" [(ngModel)] ='container.lot.lot_name' name="name" disabled>
						  </mat-form-field>
						
						 <app-select2-material-lot 
								
								fxLayoutAlign="start center"
								placeholder="Lot Name" 
								*ngIf="container.lot.material.id && editLot"
								enable_create="true"
								query_params='{"material_id":{{container.lot.material.id}}}'
								(selectedValue)="changedLot($event)"
								[default_lot]="container.lot"
								[disabled]="!editLot"
								
						 ></app-select2-material-lot>
						<p *ngIf="editLot && !newLotCreated" color="primary"> Select or type a new lot. </p>
						<mat-chip-list *ngIf="newLotCreated">
						 <mat-chip color="accent">New Lot Created!</mat-chip>
						</mat-chip-list>
					
						
					</div>		
					
						
					
					
				</div>
					<div fxLayout="row wrap"  fxLayoutAlign="end center">
					
					<button mat-button *ngIf="canEdit"  (click)="editLot = !editLot"  > Edit </button>
					
					</div>
			</mat-expansion-panel> -->
			
		</mat-accordion>
		
	
		<div fxLayout="column" fxFlex fxLayoutGap="20px">
			<div fxFlex>
				<mat-card class="quantiam-mat-card" style="padding-bottom:10px !important;"   >
				<mat-card-title style="margin:0px">
					Container Attributes
				</mat-card-title>		
					<mat-card-content fxLayoutGap="20px"   >
					
						
					<!-- 	<img fxFlex width=75px height=75px    [(src)]="container.datamatrix"/>  -->
					
					<div fxLayoutGap="30px"  class="top-mat-form-buffer" fxLayout="row wrap">	
								

							<mat-form-field *ngIf="!editContainer" class="full-width" fxFlex>
									<input  type="text" matInput placeholder="Lot name" [(ngModel)] ='container.lot.lot_name' name="name" disabled>
								</mat-form-field>
							  <div *ngIf="container.lot.material.id && editContainer">
									<label>Lot Name </label>
									<app-select2-material-lot 
										
									fxLayoutAlign="start center"
									placeholder="Lot Name" 
									
									enable_create="true"
									query_params='{"material_id":{{container.lot.material.id}}}'
									(selectedValue)="changedLot($event)"
									[default_lot]="container.lot"
									[disabled]="!editContainer"
									
									></app-select2-material-lot>
							</div>
					 
								<mat-form-field class="full-width" fxFlex>
										<input  #ContainerName (change)="updateContainerField(ContainerName)" [disabled]="!editContainer"   type="text" matInput placeholder="Container Name " [(ngModel)] ='container.container_name' name="container_name" >
										<mat-hint> Optional </mat-hint>
									</mat-form-field >  
									<mat-form-field fxFlex="20"  class="full-width">
										<input  #ContainerNumber (change)="updateContainerField(ContainerNumber)"  [disabled]="!editContainer" type="text" matInput placeholder="Container #" [(ngModel)] ='container.container_number' name="container_number" >
									</mat-form-field>   
									
									<mat-form-field fxFlex class="full-width">
											<mat-select 
													#LocationId
													placeholder="Location"
													name="location_id"
													[(ngModel)]="container.location_id"
													
													
													[disabled]="!editContainer"
													(ngModelChange)="updateContainerField($event,'location_id')"
											>
												<mat-option
													*ngFor="let location of locationList" 
													[value]="location.id"
													
													>{{location.name}}</mat-option>
											</mat-select>
									
									
									</mat-form-field>   

									<!-- {{locationList}} -->
								
					
								
								
								<mat-form-field class="full-width" fxFlex="10" >
												<input  #Denomination (change)="updateContainerField(Denomination)" [disabled]="!editContainer" type="text" matInput placeholder="Denomination" [(ngModel)] ='container.denomination' name="denomination" >
								</mat-form-field >
								<mat-form-field  fxFlex.gt-lg="20" fxFlex="30" class="full-width">
									<input #AmountOrdered (change)="updateContainerField(AmountOrdered)" [disabled]="!editContainer"   type="text" matInput placeholder="Amount Ordered ({{container.denomination}})" [(ngModel)] ='container.amount_ordered' name="amount_ordered" >
								</mat-form-field >
								<mat-form-field  fxFlex class="full-width">
									<input #GrossWeight (change)="updateContainerField(GrossWeight)" [disabled]="!editContainer"  type="text" matInput placeholder="Gross Weight (g)" [(ngModel)] ='container.gross_weight' name="gross_weight" >
								</mat-form-field>	

								<mat-form-field  fxFlex class="full-width">
									<input #Remaining (change)="updateContainerField(Remaining)" [disabled]="!editContainer"  type="text" matInput placeholder="Remaining Weight (g)" [(ngModel)] ='container.remaining' name="remaining" >
								</mat-form-field>	 
								
					
								<mat-form-field fxFlex>
										<input  #PurchaseOrder (change)="updateContainerField(PurchaseOrder)" [disabled]="!editContainer"  type="text" matInput placeholder="P.O. #" [(ngModel)] ='container.purchase_order' name="purchase_order" >
									</mat-form-field>  
									
								<mat-form-field class="full-width" fxFlex>
								<input matInput [matDatepicker]="myDatepicker2" placeholder="Date Received" [(ngModel)] ='container.container_received' (dateChange)="updateContainerField($event.value,'container_received')" [disabled]="!editContainer">
								<mat-datepicker-toggle matSuffix [for]="myDatepicker2"></mat-datepicker-toggle>
								<mat-datepicker #myDatepicker2></mat-datepicker>
								</mat-form-field>
								<mat-form-field class="full-width" fxFlex>
								<input matInput [matDatepicker]="myDatepicker" placeholder="Date Opened" [(ngModel)] ='container.container_opened' (dateChange)="updateContainerField($event.value,'container_opened')" [disabled]="!editContainer">
								<mat-datepicker-toggle matSuffix [for]="myDatepicker"></mat-datepicker-toggle>
								<mat-datepicker #myDatepicker></mat-datepicker>
								</mat-form-field>
								
								
								<mat-form-field fxFlex>
										<input  #QCID (change)="updateContainerField(QCID)" [disabled]="!editContainer"  type="text" matInput placeholder="QCID (optional)" [(ngModel)] ='container.qcid' name="qcid" >
									</mat-form-field>  

												

												
						</div>	
					</mat-card-content>
					
					<mat-card-actions >	
						
						<mat-checkbox (change)="changeContainerStatus()" style="margin-left:15px" [disabled]="!editContainer" [(ngModel)] ='container.active' name="active" fxLayoutAlign="start center">Active</mat-checkbox>
						
						<div  fxLayoutAlign="end center" fxFlex>
									<button mat-button (click)="generateMaterialLargeLabelDownload()" > Print Large Label </button> 			
									<button mat-button  *ngIf="canEdit"  (click)="editContainer = !editContainer"  > Edit </button>						
									<button mat-button   *ngIf="canEdit" (click)="deleteContainer()"  color="warn"  >  Delete </button>						
									<!-- <button mat-button routerLink="/material/{{container.lot.material.id}}" >MSDS</button> -->
						</div>
					</mat-card-actions>
					
						
				</mat-card>
			</div>
		<!-- <select2-material ></select2-material> -->

	
	
	
	
		</div>
	</div>


		<iframe  [hidden]="!container.lot.material.sds" src="" type="application/pdf"  height="800px" style="overflow: auto; min-width: 50%;">
		</iframe> 
	
	 
	<div fxLayout="row" id="MSDS SECTION" *ngIf="!container.lot.material.sds"  fxFlex fxLayoutGap="20px">
		
		
			<div fxFlex fxLayout="column" fxLayoutGap="20px">

					<ngb-alert type="danger"  [dismissible]="false"> <b> Oops </b> We can't find an SDS. Employers are required by <a target="_blank" href="https://www.ccohs.ca/oshanswers/chemicals/whmis_ghs/sds.html"> federal WHIMIS 2015 legislation </a> to have an SDS readily accessible.  </ngb-alert>
						
					<file-drop headertext="Drop SDS file here" (onFileDrop)="dropped($event)"  showBrowseBtn="false"
					(onFileOver)="fileOver($event)" (onFileLeave)="fileLeave($event)">
						
					</file-drop>
					<div class="upload-table" *ngIf="files[0]">
							<table class="table">
								<thead>
									<tr>
										<th>Name</th>
									</tr>
								</thead>
								<tbody class="upload-name-style">
									<tr *ngFor="let item of files; let i=index">
										<td><strong>{{ item.relativePath }}</strong></td>
									</tr>
								</tbody>
							</table>
						</div>


					<div *ngIf="searchingPossibleSDS && !sdsSearch[0]" fxLayoutAlign="center center" fxLayout="column">

							<mat-spinner diameter=10></mat-spinner>
							<p>Searching online for possible SDS</p>
					</div>

				
				

			</div>

			<div *ngIf="!searchingPossibleSDS && sdsSearch[0]" fxFlex>
					<ngb-alert type="warning"  [dismissible]="false"> Here is a list of possible SDS's from <a target="_blank" href="https://chemicalsafety.com/sds-search/"> sds.chemicalsafety.com </a>  to help you out. </ngb-alert>
					<mat-card   class="quantiam-mat-card" style="padding-bottom:10px !important;"   >
							<mat-card-title style="margin:0px">
								Possible Safety Data Sheet(s) 
						</mat-card-title>		
						<mat-card-content fxLayoutGap="20px"   >

								
								

								<table class="table">
										<thead>
										<tr>
										<th scope="col">ID</th>
										<th scope="col">Material Name</th>
										<th scope="col">Manufacturer</th>
										<th scope="col">CAS#</th>
										<!-- <th scope="col"></th>  -->
										
										</tr>
										</thead>
										<tbody>
												<tr class="clickable" *ngFor="let item of sdsSearch" >

														<td  (click)="navigateToSDS(item)"> {{item[0]}} </td>
														<td  (click)="navigateToSDS(item)"> {{item[1]}} </td>
														<td  (click)="navigateToSDS(item)"> {{item[2]}} </td>
														<td  (click)="navigateToSDS(item)"> {{item[3]}} </td>
														<!-- <td>
															<button mat-button matTooltip="Remember this SDS for another time.">Save
															</button>
														</td>  -->
												</tr>

										</tbody>
								</table>
						</mat-card-content>
					</mat-card>

			</div>

	
	</div>




</div>
	